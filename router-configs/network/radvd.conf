# Router Advertisement Daemon Configuration
# ORION Router VM 200 - IPv6 SLAAC
# Provides automatic IPv6 configuration for LAN clients

# ============================================================================
# LAN Interface (eth1) - 2602:F674:1000::/64
# ============================================================================
interface eth1 {
    # Enable router advertisements
    AdvSendAdvert on;

    # Minimum time between RAs (seconds)
    MinRtrAdvInterval 3;

    # Maximum time between RAs (seconds)
    MaxRtrAdvInterval 10;

    # Don't use DHCPv6 for address assignment (use SLAAC)
    AdvManagedFlag off;

    # Use DHCPv6 for other configuration (DNS, NTP, etc.)
    AdvOtherConfigFlag on;

    # Router lifetime (0 = not a default router, >0 = default router)
    AdvDefaultLifetime 1800;

    # Preference for this router (low, medium, high)
    AdvDefaultPreference high;

    # Link MTU
    AdvLinkMTU 1500;

    # Reachable time (milliseconds)
    AdvReachableTime 30000;

    # Retrans timer (milliseconds)
    AdvRetransTimer 1000;

    # Current hop limit
    AdvCurHopLimit 64;

    # Prefix for LAN
    prefix 2602:F674:1000::/64 {
        # Prefix is on-link
        AdvOnLink on;

        # Clients can use SLAAC
        AdvAutonomous on;

        # Include router address in RA
        AdvRouterAddr on;

        # Valid lifetime (seconds) - how long prefix is valid
        AdvValidLifetime 86400;  # 24 hours

        # Preferred lifetime (seconds) - how long to prefer this prefix
        AdvPreferredLifetime 43200;  # 12 hours
    };

    # Recursive DNS Servers (Cloudflare)
    RDNSS 2606:4700:4700::1111 2606:4700:4700::1001 {
        AdvRDNSSLifetime 300;
    };

    # DNS Search List
    DNSSL orion.local {
        AdvDNSSLLifetime 300;
    };

    # Route Information (optional - for more specific routes)
    # route 2602:F674::/48 {
    #     AdvRouteLifetime 1800;
    #     AdvRoutePreference high;
    # };
};

# ============================================================================
# Guest Network Interface (eth2) - 2602:F674:2000::/64
# ============================================================================
interface eth2 {
    AdvSendAdvert on;

    MinRtrAdvInterval 3;
    MaxRtrAdvInterval 10;

    AdvManagedFlag off;
    AdvOtherConfigFlag on;

    AdvDefaultLifetime 1800;
    AdvDefaultPreference medium;  # Lower than LAN

    AdvLinkMTU 1500;

    prefix 2602:F674:2000::/64 {
        AdvOnLink on;
        AdvAutonomous on;
        AdvRouterAddr on;
        AdvValidLifetime 86400;
        AdvPreferredLifetime 43200;
    };

    # Use public DNS for guest network (no local DNS)
    RDNSS 2606:4700:4700::1111 2606:4700:4700::1001 {
        AdvRDNSSLifetime 300;
    };

    DNSSL guest.orion.local {
        AdvDNSSLLifetime 300;
    };
};

# ============================================================================
# Management Network Interface (eth3) - 2602:F674:3000::/64
# ============================================================================
interface eth3 {
    AdvSendAdvert on;

    MinRtrAdvInterval 3;
    MaxRtrAdvInterval 10;

    AdvManagedFlag off;
    AdvOtherConfigFlag on;

    AdvDefaultLifetime 1800;
    AdvDefaultPreference high;

    AdvLinkMTU 1500;

    prefix 2602:F674:3000::/64 {
        AdvOnLink on;
        AdvAutonomous on;
        AdvRouterAddr on;
        AdvValidLifetime 86400;
        AdvPreferredLifetime 43200;
    };

    RDNSS 2606:4700:4700::1111 2606:4700:4700::1001 {
        AdvRDNSSLifetime 300;
    };

    DNSSL mgmt.orion.local {
        AdvDNSSLLifetime 300;
    };
};

# ============================================================================
# NOTES
# ============================================================================
#
# Test configuration:
#   radvd -c /etc/radvd.conf -C
#
# Start daemon:
#   systemctl start radvd
#
# Check status:
#   systemctl status radvd
#
# Monitor RAs on client:
#   rdisc6 eth0
#   tcpdump -i eth0 -n icmp6
#
# Verify clients receive addresses:
#   ip -6 addr show
#
# Expected client address format:
#   2602:f674:1000::<EUI-64 or random>/64
#
